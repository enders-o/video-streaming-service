server {
    listen 80;

    # Redirect all requests to the login page unless the user is authenticated
    location / {
        # If the user isn't authenticated, send them to the login page
        if ($arg_user != "${AUTH_USERNAME}" || $arg_pass != "${AUTH_PASSWORD}") {
            return 302 /login;
        }

        # If authenticated, proxy to the web app running on port 3000
        proxy_pass http://localhost:3000;
        include proxy_params;
    }

    # Authentication page
    location /login {
        proxy_pass http://localhost:8080;
        include proxy_params;
    }
}
